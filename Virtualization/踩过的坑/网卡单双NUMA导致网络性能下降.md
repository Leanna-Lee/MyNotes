# 网卡单双NUMA导致网络性能下降  
## 测试场景  
在两台KVM宿主机上各部署多台虚拟机，在虚拟机之间使用iperf3进行一对一跨宿主机打流测试。
在测试中发现，3对VM在跨宿主机打流时每组网络带宽可达到940Mbps（接近限速1Gbps）；当VM数量增加到某一数值时，每组网络带宽突降，甚至低于100Mbps。　　
## 问题原因
- 在没有NUMA影响的情况下，多对VM跨宿主机网络测试性能正常，每组带宽接近限速1Gbps；  
- 当有NUMA影响时，物理网口bond时使用了不同NUMA Node所对应的网卡。跨NUMA Node内存访问的高延迟导致发送时的锁同步竞争代价急剧增大，使得网口发送成为瓶颈，进而拉低每组VM之间的网络打流性能。　　
　
